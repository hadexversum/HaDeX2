---
title: "Comparison between versions"
output: 
  rmarkdown::html_vignette:
    toc: true
    number_sections: true
    always_allow_html: yes
bibliography: HDX.bib
vignette: >
  %\VignetteIndexEntry{Comparison between versions}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This article discuss differences between the first version of HaDeX, and the current version of the package and web-server. As the second version is significantly more complex than the previous one, we ultimately decided against expanding the first version. Instead we created a new entity. But how are they different?

# Methods of visualization 

Let's start by discussing methods of visualization available in the packages and web-servers:

```{r echo = FALSE}
data.frame(plot_type = c("comparison", "woods", 
                     "uptake curve", "diff uptake curve", 
                     "butterfly", "diff butterfly", 
                     "chiclet", "diff chiclet", 
                     "heatmap", "diff heatmap", 
                     "3D structure",
                     "volcano", 
                     "manhattan",
                     "uncertainty",
                     "coverage", "coverage heatmap",
                     "measurement variablity", "mass uptake curve"),
           HaDeX = c(TRUE, TRUE, 
                     TRUE, FALSE,
                     FALSE, FALSE,
                     FALSE, FALSE,
                     FALSE, FALSE,
                     FALSE, 
                     FALSE, 
                     FALSE, 
                     FALSE, 
                     TRUE, FALSE, 
                     FALSE, FALSE),
           HaDeX2 = c(TRUE, TRUE,
                      TRUE, TRUE,
                      TRUE, TRUE, 
                      TRUE, TRUE,
                      TRUE, TRUE,
                      TRUE,
                      TRUE,
                      TRUE,
                      TRUE,
                      TRUE, TRUE, 
                      TRUE, TRUE)
           )
```

# Web-server features

Let's see how the features in web-servers differ.

```{r echo=FALSE}
data.frame(option = c("tooltips", "helpers", "tabular data", "times next to each other", "export to external tools"),
           HaDeX = c(TRUE, TRUE, TRUE, FALSE, FALSE), 
           HaDeX2 = c(TRUE, TRUE, TRUE, TRUE, TRUE))
```

In the table there are shortened names. *Tabular data* means that the tabular data is available for the plot. *Times next to each other* means the option of showing all time point data in two forms: one plot or smaller plots next to each other for time point separately. *Export to external tools* means an option to dowload data for tools such as HDXViewer or ChimeraX.

Moreover, in HaDeX2 more visualization options are available. 

# Package functions

Finally, let's take a look at package functions from HaDeX2 and see if there is a similar function in HaDeX (even under different name)

```{r echo=FALSE}
data.frame(HaDeX2 = c("add_stat_dependency", "calculate_aggregated_diff_uptake", "calculate_aggregated_test_results", "calculate_aggregated_uptake", "calculate_auc", "calculate_back_exchange", "calculate_confidence_limit_values", "calculate_diff_uptake", "calculate_exp_masses", "calculate_exp_masses_per_replicate", "calculate_kinetics", "calculate_MHP", "calculate_p_value", "calculate_peptide_kinetics", "calculate_state_uptake", "create_aggregated_diff_uptake_dataset", "create_aggregated_uptake_dataset", "create_control_dataset", "create_diff_uptake_dataset", "create_kinetic_dataset", "create_overlap_distribution_dataset", "create_p_diff_uptake_dataset", 
"create_p_diff_uptake_dataset_with_confidence", "quality_control_dataset", "create_replicate_dataset", "create_state_comparison_dataset", "create_state_uptake_dataset", "create_uptake_dataset", "get_n_replicates", "get_peptide_sequence", "get_protein_coverage", 
"get_protein_redundancy", "get_replicate_list_sd", "get_residue_positions", "get_structure_color", 
"HaDeX_GUI", "HaDeXify", "install_GUI", "plot_aggregated_differential_uptake",  "plot_aggregated_uptake", "plot_aggregated_uptake_structure", "plot_amino_distribution", 
"plot_butterfly", "plot_chiclet", "plot_coverage", "plot_coverage_heatmap", 
"plot_differential", "plot_differential_butterfly", "plot_differential_chiclet",   
"plot_differential_uptake_curve", "plot_manhattan", "plot_overlap", "plot_overlap_distribution", "plot_peptide_charge_measurement", "plot_peptide_mass_measurement", "plot_position_frequency", "plot_quality_control", "plot_replicate_histogram", "plot_replicate_mass_uptake", "plot_state_comparison", "plot_uncertainty", "plot_uptake_curve", "plot_volcano", "prepare_hdxviewer_export", "read_hdx", "reconstruct_sequence", "show_aggregated_uptake_data", 
"show_coverage_heatmap_data", "show_diff_uptake_data", "show_diff_uptake_data_confidence", "show_overlap_data", "show_p_diff_uptake_data", "show_peptide_charge_measurement", "show_peptide_mass_measurement", "show_quality_control_data", "show_replicate_histogram_data", "show_summary_data", "show_uc_data", "show_uptake_data", "update_hdexaminer_file"),
HaDeX = c("add_stat_dependency", NA, NA,NA, NA, NA, "calculate_confidence_limit_values", NA, NA, NA, "calculate_kinetics",
NA, NA, NA, NA, NA, NA, NA, NA, NA, 

NA, NA, NA, NA, NA, NA, "calculate_state_deuteration", NA, NA, NA,
NA, NA, NA, NA, NA, "HaDeX_gui", NA, NA, NA, NA,
NA, NA, NA, NA, "plot_coverage", NA, "woods_plot", NA, NA, NA,
NA, NA, "plot_position_frequency", NA, NA, NA, NA, NA, NA, "comparison_plot",

NA, "plot_kinetics", NA, NA, "read_hdx", "reconstruct_sequence", NA, NA, NA, NA,
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA))


```
For pairs of functions, we can conduct the analysis of speed using our exemplary data.


# Calculation speeds compared

Now we establish the common functionalities for both versions of the package. Using our exemplary data set, we will check the calculation times.

Here, I use outputs produced outside of this article, as I need to compare two packages with the same name.


## Reading a file

This function is called only once, in the beginning of the analysis. Here, we use an external file to call the read_hdx function. 
 
### HaDeX

Unit: milliseconds
                                                                         expr
                                                                         
dat <- read_hdx("C:\\\\Users\\\\User\\\\Desktop\\\\alpha dane\\\\alpha_cut.csv")

      min       lq      mean   median        uq      max neval
  28.0388  29.1341  32.51439  29.7644  31.62845 171.7444   100

 
### HaDeX2

Unit: milliseconds
                                                                         expr
                                                                         
dat <- read_hdx("C:\\\\Users\\\\User\\\\Desktop\\\\alpha dane\\\\alpha_cut.csv")

     min       lq     mean  median        uq      max neval
 91.6636 93.69305 99.43469 95.7432 102.23875 247.0202   100

 
### Results

Both packages have a same-called read_hdx function. However, the backend of HaDeX2 is way more complex as there is a specific data class used, and several additional check resulting in the speed of reading and processing a file. 

## Ploting a deuterium uptake curve for one state

### HaDeX

Unit: milliseconds
                                                                    
expr

plt_uc <- dat %>% calculate_kinetics(sequence = "GFGDLKSPAGL",      state = "Alpha_KSCN", start = 1, end = 11, time_in = 0, time_out = 1440) %>%      plot_kinetics()

    min       lq      mean   median        uq      max neval
136.4894 146.8239 150.48729 150.3550 154.47640 163.5035   100                                                                                                
                                                                                                
### HaDeX2

Unit: milliseconds

expr
plt_uc <- dat %>% calculate_peptide_kinetics(sequence = "GFGDLKSPAGL",      state = "Alpha_KSCN", start = 1, end = 11, time_0 = 0, time_100 = 1440) %>%      plot_uptake_curve()

     min       lq     mean  median        uq      max neval
 58.4832 60.72755 66.37970 62.4120  69.29155 187.8984   100
 
### Results

HaDeX2 plots uptake curve significantly faster.

## Plotting a comparison plot

HaDeX plots the comparison plot only for two states.
### HaDeX 

Unit: milliseconds

expr

kin_dat <- prepare_dataset(dat = dat, in_state_first = "Alpha_KSCN_0",      chosen_state_first = "Alpha_KSCN_1", out_state_first = "Alpha_KSCN_1440",      in_state_second = "ALPHA_Gamma_0", chosen_state_second = "ALPHA_Gamma_1",      out_state_second = "ALPHA_Gamma_1440")

plt_comparison <- comparison_plot(calc_dat = kin_dat, theoretical = FALSE,      relative = TRUE, state_first = "Alpha_KSCN", state_second = "ALPHA_Gamma")

      min        lq      mean    median       uq      max neval
 157.7022 165.72550 172.73356 170.71385 175.2435 318.6424   100
   9.3999  10.19565  12.02505  10.55955  10.9895  38.9871   100

### HaDeX2

Unit: milliseconds
                                                                         expr
                                                                         
 kin_dat <- create_state_comparison_dataset(dat = dat, states = c("Alpha_KSCN",      "ALPHA_Gamma"), time_0 = 0, time_100 = 1440)

plt_comparison <- plot_state_comparison(kin_dat, theoretical = FALSE,      fractional = TRUE, time_t = 1)
     min       lq     mean   median       uq      max neval
 41.5048 42.95650 46.76892 43.78060 45.16160 182.4834   100
 10.8284 11.47095 12.03373 11.78595 12.25255  21.2830   100

### Results

The calculations are significantly faster in HaDeX2, but the difference in plotting time is resulting by new options e.q. selecting the line size, or interactive mode for GUI.

## Plotting a Woods's plot

### HaDeX

Unit: milliseconds

expr

kin_dat <- prepare_dataset(dat = dat, in_state_first = "Alpha_KSCN_0",      chosen_state_first = "Alpha_KSCN_1", out_state_first = "Alpha_KSCN_1440",      in_state_second = "ALPHA_Gamma_0", chosen_state_second = "ALPHA_Gamma_1",      out_state_second = "ALPHA_Gamma_1440")
                                                                         plt_woods <- woods_plot(calc_dat = kin_dat, theoretical = FALSE,      relative = TRUE, confidence_limit = 0.98, confidence_limit_2 = 0.98)

      min       lq      mean   median        uq      max neval
 161.3896 167.9713 176.92851 172.3157 179.08035 326.0088   100
  21.7723  23.4672  25.36956  23.9711  24.80085  53.3279   100

### HaDeX2

Unit: milliseconds

expr

diff_uptake_dat <- create_diff_uptake_dataset(alpha_dat, state_1 = "Alpha_KSCN",      state_2 = "ALPHA_Gamma", time_0 = 0, time_100 = 1440)

plt_woods <- plot_differential(diff_uptake_dat = diff_uptake_dat,      time_t = 1, theoretical = FALSE, fractional = TRUE, show_houde_interval = TRUE,      confidence_level = 0.98)
      min       lq      mean   median        uq       max neval
 300.9806 311.9323 331.69155 316.9297 323.84895 1387.3480   100
  20.9315  22.2258  23.62265  22.9664  23.85335   33.9916   100

### Results 

As above, the plotting takes more time as it coping with option to include hybrid statistical testing, as proposed in *Hageman TS, Weis DD. Reliable Identification of Significant Differences in Differential Hydrogen Exchange-Mass Spectrometry Measurements Using a Hybrid Significance Testing Approach. Anal Chem. 2019 Jul 2;91(13):8008-8016. doi: 10.1021/acs.analchem.9b01325. Epub 2019 Jun 11. PMID: 31099554*.
# Conclusions

The HaDeX2 package is significantly more powerful than the previous version. Moreover, it was rewritten for the comfort of use - as can be shown even by the glance of parameteres supplied to the function. 