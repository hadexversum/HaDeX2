<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Calculations • HaDeX2</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculations">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">HaDeX2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/data_input.html">Importing data</a></li>
    <li><a class="dropdown-item" href="../articles/datafiles.html">Calculations</a></li>
    <li><a class="dropdown-item" href="../articles/example.html">Example HDX-MS data analysis</a></li>
    <li><a class="dropdown-item" href="../articles/glossary.html">Glossary</a></li>
    <li><a class="dropdown-item" href="../articles/mass_comparison.html">Mass calculation</a></li>
    <li><a class="dropdown-item" href="../articles/quality_control.html">Quality control</a></li>
    <li><a class="dropdown-item" href="../articles/statistics.html">Statistics</a></li>
    <li><a class="dropdown-item" href="../articles/transformation.html">Data aggregation</a></li>
    <li><a class="dropdown-item" href="../articles/usage.html">Code usage</a></li>
    <li><a class="dropdown-item" href="../articles/version_comparison.html">Comparison between versions</a></li>
    <li><a class="dropdown-item" href="../articles/visualization.html">Data visualization</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calculations</h1>
            
      

      <div class="d-none name"><code>datafiles.Rmd</code></div>
    </div>

    
    
<p>This article explains how HaDeX2 processes raw HDX-MS data files into aggregated datasets used for downstream analysis and visualization. It describes the processing of the data, the calculation workflow, and the results. For the visualization methods of described values, see <code><a href="../articles/visualization.html">vignette("visualization")</a></code>.</p>
<div class="section level2" number="1">
<h2 id="initial-processing-of-the-data">
<span class="header-section-number">1</span> Initial processing of the data<a class="anchor" aria-label="anchor" href="#initial-processing-of-the-data"></a>
</h2>
<p>Let’s start with a glimpse of the datafile - in this case, in <code>cluster</code> format from DynamX. For more information about accepted datafiles see <code><a href="../articles/data_input.html">vignette("data_input")</a></code></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://hadexversum.github.io/HaDeX2/">HaDeX2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">alpha_dat</span>, <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      Protein Start   End    Sequence Modification MaxUptake      MHP</span></span>
<span><span class="co">##       &lt;char&gt; &lt;int&gt; &lt;int&gt;      &lt;char&gt;       &lt;lgcl&gt;     &lt;int&gt;    &lt;num&gt;</span></span>
<span><span class="co">## 1: db_eEF1Ba     1    11 GFGDLKSPAGL           NA         9 1061.563</span></span>
<span><span class="co">## 2: db_eEF1Ba     1    11 GFGDLKSPAGL           NA         9 1061.563</span></span>
<span><span class="co">## 3: db_eEF1Ba     1    11 GFGDLKSPAGL           NA         9 1061.563</span></span>
<span><span class="co">## 4: db_eEF1Ba     1    11 GFGDLKSPAGL           NA         9 1061.563</span></span>
<span><span class="co">## 5: db_eEF1Ba     1    11 GFGDLKSPAGL           NA         9 1061.563</span></span>
<span><span class="co">## 6: db_eEF1Ba     1    11 GFGDLKSPAGL           NA         9 1061.563</span></span>
<span><span class="co">##          State Exposure                              File     z  Inten</span></span>
<span><span class="co">##         &lt;char&gt;    &lt;num&gt;                            &lt;char&gt; &lt;int&gt;  &lt;int&gt;</span></span>
<span><span class="co">## 1: ALPHA_Gamma    0.000 Tania_161112_eEF1Ba_KSCN_IMS_seq1     1 138844</span></span>
<span><span class="co">## 2: ALPHA_Gamma    0.000 Tania_161112_eEF1Ba_KSCN_IMS_seq1     2 728218</span></span>
<span><span class="co">## 3: ALPHA_Gamma    0.167  Tania_161109_1eEF1Bag_KSCN_10sec     1  41100</span></span>
<span><span class="co">## 4: ALPHA_Gamma    0.167  Tania_161109_1eEF1Bag_KSCN_10sec     2 393115</span></span>
<span><span class="co">## 5: ALPHA_Gamma    0.167  Tania_161109_2eEF1Bag_KSCN_10sec     1  46642</span></span>
<span><span class="co">## 6: ALPHA_Gamma    0.167  Tania_161109_2eEF1Bag_KSCN_10sec     2 466233</span></span>
<span><span class="co">##       Center</span></span>
<span><span class="co">##        &lt;num&gt;</span></span>
<span><span class="co">## 1: 1062.1913</span></span>
<span><span class="co">## 2:  531.6754</span></span>
<span><span class="co">## 3: 1064.0150</span></span>
<span><span class="co">## 4:  532.4975</span></span>
<span><span class="co">## 5: 1063.9682</span></span>
<span><span class="co">## 6:  532.4951</span></span></code></pre>
<p>As we see, the data file has a very specific structure and is not informative yet. In the file, we have <span class="math inline">\(m/z\)</span> values for each <span class="math inline">\(z\)</span> value (charge) for each time point (<span class="math inline">\(Exposure\)</span>) for each state of each peptide, repeated as many times as measurement was repeated (each measurement should be repeated at least three times).</p>
<p>Our aim is to have one result with an uncertainty of the measurement per each peptide in each biological state in each measured time point - data in this format allows further calculations, e.q. calculating deuterium uptake values.</p>
<p>For a better understanding of the process of aggregating the data, see the <code><a href="../articles/transformation.html">vignette("transformation")</a></code> article.</p>
<p>Within each replicate of the measurement (we recognize each replicate by the <span class="math inline">\(File\)</span> value), the <span class="math inline">\(m/z\)</span> values are provided for each possible <span class="math inline">\(z\)</span> value. The <span class="math inline">\(m/z\)</span> values are in the <span class="math inline">\(Center\)</span> column, as it is a geometrical centroid calculated from the isotopic envelope. Firstly, we have to calculate the mass value, measured experimentally:</p>
<p><span class="math display">\[expMass = z \times (Center-protonMass)\tag{1}\]</span>
To aggregate data from different <span class="math inline">\(z\)</span> values, we have to calculate the mean mass weighted by intensity. Additional information about this step and how the weighted mean impacts the results can be found in <code><a href="../articles/mass_comparison.html">vignette("mass_comparison")</a></code> article.</p>
<p><span class="math display">\[aggMass = \frac{1}{N}\sum_{k = 1}^{N}Inten_k{\cdot}pepMass_k\tag{2}\]</span>.</p>
<p>Where:</p>
<ul>
<li>
<span class="math inline">\(aggMass\)</span> - mass of the peptide [Da], average from replicates,</li>
<li>
<span class="math inline">\(Inten_k\)</span> - intensity of the measurement,</li>
<li>
<span class="math inline">\(pepMass\)</span> - mass of the peptide, calculated using Equation 1.</li>
</ul>
<p>As we use the aggregated result from the replicates, we need to calculate an uncertainty associated with the measurement. We use the mean value as the final result, so we need to calculate error as a standard deviation of the mean, according to the Equation 3:</p>
<p><span class="math display">\[u(\vec{x}) = \sqrt{\frac{ \sum_{i=1}^n \left( x_{i} - \overline{x} \right)^2}{n(n-1)}}\tag{3}\]</span>.</p>
<p>Where:</p>
<ul>
<li>
<span class="math inline">\(x_{i}\)</span> - measured value from a replicate,</li>
<li>
<span class="math inline">\(\overline{x}\)</span> - mean value from all of the replicates,</li>
<li>
<span class="math inline">\(n\)</span> - number of replicates.</li>
</ul>
<p>Now we have the format we want for further calculations.</p>
</div>
<div class="section level2" number="2">
<h2 id="calculation-of-the-deuterium-uptake">
<span class="header-section-number">2</span> Calculation of the deuterium uptake<a class="anchor" aria-label="anchor" href="#calculation-of-the-deuterium-uptake"></a>
</h2>
<p>HaDeX package provides the calculated values in different forms. All of them are provided with associated uncertainty of the measurement. All of the uncertainties are derived from the formula - the Law of propagation of uncertainty:</p>
<p><span class="math display">\[u_{c}(y) = \sqrt{\sum_{k} \left[ \frac{\partial y}{\partial x_{k}} u(x_{k}) \right]^2}\]</span></p>
<div class="section level3" number="2.1">
<h3 id="deuterium-uptake">
<span class="header-section-number">2.1</span> Deuterium uptake<a class="anchor" aria-label="anchor" href="#deuterium-uptake"></a>
</h3>
<p>Deuterium uptake is the increase of the mass of the peptide in time <span class="math inline">\(t\)</span>. The minimal exchange control <span class="math inline">\(m_{t_0}\)</span> is mass measured directly after adding the buffer (before the start of the exchange), and <span class="math inline">\(m_t\)</span> is the mass measured in chosen time point <span class="math inline">\(t\)</span>. The value is in Daltons [Da].</p>
<p><span class="math display">\[D = m_{t} - m_{t_0}\]</span>
The uncertainty associated with deuterium uptake [Da] (based on equation 3):</p>
<p><span class="math display">\[u_c(D) = \sqrt{u(m_t)^2 + u(m_{t_0})^2}\]</span></p>
</div>
<div class="section level3" number="2.2">
<h3 id="fractional-deuterium-uptake">
<span class="header-section-number">2.2</span> Fractional deuterium uptake<a class="anchor" aria-label="anchor" href="#fractional-deuterium-uptake"></a>
</h3>
<p>Fractional deuterium uptake is the ratio of the increase of the mass in time <span class="math inline">\(t\)</span> to the maximal exchange control. The maximal exchange control <span class="math inline">\(m_{t_{100}}\)</span> is measured after a long time (chosen by the experimenter, usually 1440 min = 24 h). It is assumed that after this long time, the exchange is finished. The minimal exchange control <span class="math inline">\(m_{t_0}\)</span> is mass measured directly after adding the buffer (before the start of the exchange), and <span class="math inline">\(m_t\)</span> is the mass measured in chosen time point <span class="math inline">\(t\)</span>. This value is a percentage value [%].</p>
<p><span class="math display">\[D_{frac} = \frac{m_{t} - m_{t_0}}{m_{t_{100}} - m_{t_0}}\]</span></p>
<p>The uncertainty associated with fractional deuterium uptake [%] (based on equation 3):</p>
<p><span class="math display">\[u_{c}(D_{frac}) = \sqrt{ \left[
\frac{1}{m_{t_{100}}-m_{t_0}} u(m_{t}) \right]^2 +
\left[ \frac{m_{t} - m_{t_{100}}}{(m_{t_{100}}-m_{t_0})^2} u(m_{t_0}) \right]^2 +
\left[ \frac{m_{t_0} - m_{t}}{(m_{t_{100}}-m_{t_0})^2} u (m_{t_{100}}) \right]^2}\]</span></p>
</div>
<div class="section level3" number="2.3">
<h3 id="theoretical-deuterium-uptake">
<span class="header-section-number">2.3</span> Theoretical deuterium uptake<a class="anchor" aria-label="anchor" href="#theoretical-deuterium-uptake"></a>
</h3>
<p>Theoretical deuterium uptake is the increase of mass in time <span class="math inline">\(t\)</span> compared with the theoretical value of the peptide mass without any exchange (<span class="math inline">\(MHP\)</span> - a mass of the singly charged monoisotopic molecular ion), and <span class="math inline">\(m_t\)</span> is the mass measured in chosen time point <span class="math inline">\(t\)</span>. This value is in daltons [Da]:</p>
<p><span class="math display">\[D_{theo} = m_{t} - MHP\]</span></p>
<p>The uncertainty associated with theoretical deuterium uptake [Da] (the <span class="math inline">\(MHP\)</span> value is a constant without measurement uncertainty - based on the equation 3):</p>
<p><span class="math display">\[u(D_{theo}) = u(m_t)\]</span></p>
</div>
<div class="section level3" number="2.4">
<h3 id="theoretical-fractional-deuterium-uptake">
<span class="header-section-number">2.4</span> Theoretical fractional deuterium uptake<a class="anchor" aria-label="anchor" href="#theoretical-fractional-deuterium-uptake"></a>
</h3>
<p>Theoretical fractional deuterium uptake is the ratio of the increase of mass in time <span class="math inline">\(t\)</span> compared with a theoretical value of the mass of the peptide without any exchange to the possible theoretical increase of the mass, based on the maximal potential uptake of the peptide (based on the peptide sequence). This value is a percentage value [%].</p>
<p><span class="math display">\[D_{theo, frac} = \frac{m_{t}-MHP}{MaxUptake \times protonMass}\]</span></p>
<p>The uncertainty associated with theoretical fractional deuterium uptake [%] (based on the equation 3):</p>
<p><span class="math display">\[u(D_{theo, frac}) = \left|\frac{1}{MaxUptake \times protonMass} u(D_{t}) \right|\]</span></p>
</div>
</div>
<div class="section level2" number="3">
<h2 id="differential-values">
<span class="header-section-number">3</span> Differential values<a class="anchor" aria-label="anchor" href="#differential-values"></a>
</h2>
<p>Differential value is the way to see how the deuterium uptake differs between two biological states. It allows seeing if the possible difference is statistically important (more information below). This value is calculated as the difference between the previously described (in a chosen form) deuterium uptake of the first and second states.</p>
<p><span class="math display">\[diff = D_{1} - D_{2}\]</span>
The uncertainty associated with the difference of deuterium uptake (based on the equation 3):</p>
<p><span class="math display">\[u_{c}(diff) = \sqrt{u(D_{1})^2 + u(D_{2})^2}\]</span></p>
<p>The convenient way to present results calculated as described is the comparison plot and differential plot (Woods’ plot).</p>
</div>
<div class="section level2" number="4">
<h2 id="deuterium-uptake-averaging">
<span class="header-section-number">4</span> Deuterium uptake averaging<a class="anchor" aria-label="anchor" href="#deuterium-uptake-averaging"></a>
</h2>
<p>Averaging of the deuterium uptake values is inspired by an already published solution <span class="citation">(Keppel and Weis 2015)</span>. This process can be conducted of any deuterium uptake variation - fractional or absolute, with theoretical or experimental control, single-state or differential.</p>
<p>For each residue <span class="math inline">\(i\)</span> there is a subset of peptides (<span class="math inline">\(n\)</span>) covering said residue. Then, the final <span class="math inline">\(D_{i, agg}\)</span> is calculated from the subset of <span class="math inline">\(D_k\)</span> (where <span class="math inline">\(0&lt;k&lt;n\)</span>), with weights <span class="math inline">\(w_k\)</span> inverse proportional to the max uptake of peptide (<span class="math inline">\(MaxUptake_k\)</span>) - the shortest the peptide the highest the possibility that the uptake took place in said residue:</p>
<p><span class="math display">\[
w_k = \frac{\frac{1}{MaxUptake_k}}{\sum_n \frac{1}{MaxUptake_k}}
\]</span>
The weights are normalized:</p>
<p><span class="math display">\[
\sum_n w_k = 1
\]</span>
Then, the <span class="math inline">\(D_{i, agg}\)</span> is a weighted average of set of <span class="math inline">\(D_n\)</span>.</p>
<p><span class="math display">\[
D_{i, agg} = \frac{\sum_n w_k \cdot D_k}{\sum_n w_k}
\]</span>
This process is done for each residue <span class="math inline">\(i\)</span> to cover whole protein data.</p>
<p>As for previous values, also for <span class="math inline">\(D_{i, agg}\)</span> the uncertainty is calculated:</p>
<p><span class="math display">\[
u(D_{i, agg}) = \sqrt{ \sum_{n} \left[ \frac{  w_k \cdot U(D_k)}{ \sum_n w_k } \right] ^2}
\]</span></p>
</div>
<div class="section level2" number="5">
<h2 id="back-exchange">
<span class="header-section-number">5</span> Back-exchange<a class="anchor" aria-label="anchor" href="#back-exchange"></a>
</h2>
<p>Back-exchange is a reverse exchange - from already exchange deuterium back to hydrogen.</p>
<p>Back-exchange (<span class="math inline">\(bex\)</span>) is calculated for each peptide and is defined as the difference between fractional theoretical deuterium uptake of the experimental maximal deuterium control and 100% of exchange.</p>
<p><span class="math display">\[
bex = 100 - D_{theo, frac}(t_{100})
\]</span></p>
</div>
<div class="section level2" number="6">
<h2 id="AUC">
<span class="header-section-number">6</span> AUC<a class="anchor" aria-label="anchor" href="#AUC"></a>
</h2>
<p>The Area Under the Curve (AUC) represents the integral of the deuterium uptake curve. In this context, higher AUC values characterize rapidly exchanging peptides, while lower values signify minimal exchange. To constrain the results to a <span class="math inline">\([0, 1]\)</span> range, the AUC is normalized against the maximum theoretical uptake at the last measured time point. Consequently, an AUC exceeding 1 serves as a diagnostic indicator of back-exchange.</p>
<p><span class="math display">\[
\textrm{AUC} = \sum_i^{n-1} (D_{frac, i+1} + D_{frac, i}) \cdot (t_{\textrm{norm}, i+1} - t_{\textrm{norm}, i}) \cdot \frac{1}{2}
\]</span></p>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-keppel_mapping_2015" class="csl-entry">
Keppel, Theodore R., and David D. Weis. 2015. <span>“Mapping <span>Residual</span> <span>Structure</span> in <span>Intrinsically</span> <span>Disordered</span> <span>Proteins</span> at <span>Residue</span> <span>Resolution</span> <span>Using</span> <span>Millisecond</span> <span>Hydrogen</span>/<span>Deuterium</span> <span>Exchange</span> and <span>Residue</span> <span>Averaging</span>.”</span> <em>Journal of the American Society for Mass Spectrometry</em> 26 (4): 547–54. <a href="https://doi.org/10.1007/s13361-014-1033-6" class="external-link">https://doi.org/10.1007/s13361-014-1033-6</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Weronika Puchala, Michal Burdukiewicz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
